## 6. 正向代理和反向代理

- 正向代理（ 例 webpack 配置代理服务器 ）：即是客户端代理，代理客户端，服务端不知道实际发起请求的客户端。类似一个跳板机，代理访问外部资源，比如我们直接访问访问不到，我们可以通过一个正向代理服务器，请求发到代理服务器，代理服务器能够访问，这样由代理去取到返回数据，再返回给我们，这样我们就能访问了
  - 其用途：
    - 访问原来无法访问的资源
    - 可以做缓存，加速访问资源
    - 对客户端访问授权，上网进行认证
    - 代理可以记录用户访问记录（上网行为管理），对外隐藏用户信息
- 反向代理（例 nginx 配置）：即是服务端代理，代理服务端，客户端不知道实际提供服务的服务端。指以代理服务器来接受 internet 上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给 internet 上请求连接的客户端，此时代理服务器对外就表现为一个服务器
  - 其用途：
    - 保证内网的安全，阻止 web 攻击，大型网站，通常将反向代理作为公网访问地址，web 服务器是内网
    - 负载均衡，通过反向代理服务器来优化网站的负载

## 7. 前端跨域方法

### 为什么需要跨域

因为存在同源协议，即是一种约定，它是浏览器重要的安全功能，如果缺少了同源策略，浏览器很容易受到 XSS、CSFR 等攻击，所谓同源是指 "协议 + 域名 + 端口" 三者都相同，即使两个不同的域名指向同一个 ip 地址，也非同源

- 同源协议主要限制的内容是：
  - Cookie，LocalStorage 和 IndexDB 等存储性内容无法读取
  - 无法获取或操作另一个资源的 DOM
  - AJAX 请求不能发送

### 请求跨域

- 请求跨域的情况，那么请求到底发出去没有
  - 跨域并不是请求发不出去，请求能发出去，服务端能收到请求并正常返回结果，只是结果被浏览器拦截了
- 为什么表单可以发起跨域请求，而 AJAX 和 Fetch 不行
  - 因为归根结底，跨域是为了阻止用户读取到另一个域名下的内容，浏览器认为 AJAX 获取响应不安全，所以拦截了响应。但是表单并不会获取新的内容，所以可以发起跨域请求。同时也说明了跨域并不能完全阻止 CSRF，因为请求毕竟是发出去了
- 解决方法
  1.  JSONP
  2.  CORS
  3.  postMessage
  4.  websocket
      和 AJAX 请求不同，根本不附属于同源策略，而且它本身就有意被设计成可以跨域的一个手段。由于历史原因，跨域检测一直是由浏览器端来做，但是 WebSocket 出现以后，对于 WebSocket 的跨域检测工作就交给了服务端，浏览器仍然会带上一个 Origin 跨域请求头，服务端则根据这个请求头判断此次跨域 WebSocket 请求是否合法
  5.  webpack 配置正向代理
      因为同源策略是浏览器需要遵循的标准，而如果是服务器向服务器请求就无需遵循同源策略
  6.  nginx 配置反向代理
      和正向代理原理一样

### cookie 跨域

1. cookie 路径共享
   - cookie 一般都是由于用户访问页面而被创建的，可是并不是只有在创建 cookie 的页面才可以访问这个 cookie。在默认情况下，出于安全方面的考虑，只有与创建 cookie 的页面处于同一个目录或在创建 cookie 页面的子目录下的网页才可以访问。那么此时如果希望其父级或者整个网页都能够使用 cookie，就需要进行路径的设置
   - 所以我们可以通过将 cookie 路径往上“提”，来实现跨域
     ```
     cookie.setPath("/"); // 后端 java 操作
     ```
2. cookie 域名共享
   - domain 表示的是 cookie 所在的域，默认为请求的地址，设置 domain 可以指定 cookie 作用的域名范围，通常情况下， cookie 只会作用于产生于其的域名。如果想让其他域名共享，可设置 cookie 作用的域名。域名有一级域名，二级域名，三级域名等
     ```
     cookie.setDomain("test.com"); // 后端 java 操作
     ```

- 例如 - 一级域名如 baidu.com - 二级域名如 hao.baidu.com - 三级域名如 www.hao.baidu.com - 三级域名包含二级域名，二级域名包含一级域名 - setDomain 方法须以 . 开头，如 cookie.setDomain(".baidu.com")，
  则在访问 baidu.com、hao.baidu.com、www.hao.baidu.com时都可以获取到该cookie

3. nginx 反向代理
   [添加链接描述](https://www.cnblogs.com/hujunzheng/p/5744755.html)
   [添加链接描述](https://blog.csdn.net/Konaji/article/details/80775905)
   [添加链接描述](https://www.freesion.com/article/6149183094/)
