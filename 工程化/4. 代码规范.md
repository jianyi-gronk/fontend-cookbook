## 1. ESLint 和 Prettier

- ESLint 和 Prettier 是两个非常流行的 JavaScript 代码检查和格式化工具。它们可以提高代码质量，确保代码风格一致性，并在团队协作中保持高效

#### ESLint

- 是一个可扩展的静态代码分析工具，用于检查 JavaScript 和 JSX 代码中的问题。它支持自定义规则，可以检查代码中的语法错误、潜在错误、风格问题等
- 除了官方提供的规则集外，还有许多社区编写的插件和配置，例如 Airbnb, Google 和 Standard 的编码规范
- ESLint 可以与各种编辑器（如 VSCode、Sublime Text、Atom 等）集成，以便在编写代码时即时发现问题
- 主要作用，例
  - 检查潜在错误和问题
    - 不允许使用未定义的变量
    - 不允许存在未使用的变量
  - 遵循最佳实践
    - 不允许使用 eval() 函数
    - 不允许在循环中创建函数
  - 强制执行一致的代码风格
    - 使用 2 个空格进行缩进
    - 使用单引号而不是双引号
    - 在对象字面量的键和值之间添加一个空格
  - 支持自动修复许多常见的风格问题
    ```shell
    eslint "**/*.js" --fix
    ```
- 具体使用步骤

  1.  全局安装 ESLint
      ```
      npm install -g eslint
      ```
  2.  初始化 ESLint 配置，这将启动一个向导，引导你选择一些基本设置。向导会询问你关于代码风格和环境的问题，例如缩进方式、是否使用分号、目标运行环境等。根据你的选择，ESLint 会自动生成一个配置文件（如 .eslintrc.js、.eslintrc.json 或 .eslintrc.yaml），并将你选择的规则保存在其中
      ```
      eslint --init
      ```
      - 在项目中安装所需的依赖,根据在初始化向导中的选择，ESLint 可能会要求安装一些插件或配置（eslint-plugin-xxx 之类）
  3.  运行 ESLint，使用以下命令来检查项目中的所有 JavaScript 文件，ESLint 将检查文件，并报告任何不符合配置规则的地方（或者可以根据需要，将 src 替换为项目中的实际目录）
      ```
      eslint "src/**/*.js"
      ```
  4.  自动修复问题（可选），ESLint 支持自动修复某些问题，例如缩进、分号、引号等。要使用此功能，请在运行 ESLint 时添加 --fix 选项
      ```
      eslint "src/**/*.js" --fix
      ```
  5.  集成到编辑器（可选）， 为了在编写代码时实时发现问题，你可以将 ESLint 集成到你的编辑器中。许多编辑器（如 VSCode、Sublime Text、Atom 等）都提供了 ESLint 插件。安装相应的插件后，你可以在编辑器设置中启用 ESLint，以便在编写代码时即时看到错误和警告
  6.  自定义规则（可选）： 如果你需要自定义 ESLint 的规则，可以编辑配置文件（.eslintrc.js、.eslintrc.json 或 .eslintrc.yaml）并修改相应的规则设置，例
      ```
      {
          "rules": {
            "indent": ["error", 2],
            "quotes": ["error", "single"],
            "semi": ["error", "always"]
          }
      }
      ```

- 要在 TypeScript 项目中使用 ESLint 的话，步骤如下（不过在初始化 eslint 的向导中，一般会帮你配好）
  1.  需要安装 @typescript-eslint/parser 和 @typescript-eslint/eslint-plugin，这两个包分别提供了一个 TypeScript 解析器和一些针对 TypeScript 的 ESLint 规则
      ```
      npm install --save-dev @typescript-eslint/parser @typescript-eslint/eslint-plugin
      ```
  2.  在项目中 .eslintrc 配置文件中添加如下配置
      ```
      {
        extends: [
            "eslint:recommended",
            "plugin:@typescript-eslint/recommended"
          ],
          parserOptions: {
            ecmaVersion: "latest",
            sourceType: "module",
            parser: "@typescript-eslint/parser",
            jsx: true,
          },
          plugins: ["@typescript-eslint"],
          rules: {
            // 自定义 TypeScript 相关的规则
          }
      }
      ```

#### Prettier

- 是一个代码格式化工具，可以自动格式化你的 JavaScript，CSS，HTML，TypeScript 等代码
- 支持许多语言，并具有良好的默认设置，可以在项目中统一代码风格
- Prettier 有多种配置方式，比如 .prettierrc，.prettierrc.cjs 等等，如果一个项目存在多个配置文件，会根据[配置文件的优先级](https://prettier.io/docs/en/configuration.html#priority)来选择
- 具体使用步骤
  1.  全局安装 Prettier
      ```
      npm install -g prettier
      ```
  2.  创建 Prettier 配置文件（可选，在没有配置文件的情况下，Prettier 将使用默认的配置选项）有时可能需要根据项目需求对默认配置选项进行一些调整。在项目根目录下，创建一个名为 .prettierrc 的文件，并使用 JSON 格式编写你的配置
      ```
      {
        "semi": true,
        "singleQuote": true,
        "printWidth": 80,
        "tabWidth": 2
      }
      ```
  3.  运行 Prettier，现在可以在项目中运行 Prettier，使用以下命令，Prettier 将格式化项目中的所有 JavaScript 文件，并自动保存更改（或者可以根据需要，将 src 替换为项目中的实际目录）
      ```
      prettier --write "src/**/*.js"
      ```
  4.  集成到编辑器（可选），为了在保存文件时自动格式化代码，你可以将 Prettier 集成到你的编辑器中。许多编辑器（如 VSCode、Sublime Text、Atom 等）都提供了 Prettier 插件。安装相应的插件后，你可以在编辑器设置中启用 Prettier，并配置保存时自动格式化
- 有一个坑点，就是 Windows 和 Unix 系统在处理换行符的方式不同，为了解决这个问题，可以在 Prettier 的配置文件中指定换行符的类型
  ```
  {
    "endOfLine": "auto"
  }
  ```
  - 这样配置后，Prettier 将根据当前操作系统的类型自动选择正确的换行符类型，从而避免报错

#### 两者区别

- ESLint 主要关注代码质量和潜在问题，可以通过自定义规则进行灵活配置，适用于检查和修复代码中的语法错误和不规范用法（但是也可以关注代码格式和样式，但是这并不是设计目的）
- Prettier 主要关注代码的格式和样式，具有良好的默认设置，适用于在项目中统一代码风格和自动格式化代码（不可以关注语法错误）
- 并且 ESLint 只能针对 Javascript 语言代码的文件，支持 .js，.ts，.vue，.jsx，.tsx 等后缀的文件
- 而 Prettier 可以针对 JavaScript，JSON，HTML，CSS，Markdown，GraphQL 等等语言代码的文件

#### ESLint + Prettier

- 由于 ESLint 和 Prettier 都可以检查和修复代码格式问题，因此将它们结合使用时，可能会出现规则冲突，为了解决这个问题，步骤如下
  1.  可以使用 eslint-plugin-prettier（ 将 Prettier 作为一个 ESLint 规则运行 ） 和 eslint-config-prettier（将关闭所有与 Prettier 冲突的 ESLint 规则）这两个插件
      ```
      npm install --save-dev eslint-plugin-prettier eslint-config-prettier
      ```
  2.  在项目中 .eslintrc 配置文件中添加如下配置
      ```
      {
          "extends": [
            "plugin:prettier/recommended",
          ],
          "plugins": ["prettier"],
          "rules": {
            "prettier/prettier": "error"
          }
      }
      ```
- 注意，有大坑，prettier3 与 eslint-plugin-prettier4 版本不兼容，需要操作二选一
  - 把 prettier 换成 2x 的版本
  - 把 eslint-plugin-prettier 换成 5alpha 版本

## 2. Stylelint

- 是一个强大的 CSS 检查工具，它可以分析 CSS 代码并检查语法错误、潜在问题以及不符合预设规则的代码，可以保持项目中的 CSS 代码风格一致，提高代码质量

#### 基础使用

1. 安装 Stylelint
   ```shell
   npm install stylelint --save-dev
   ```
2. 创建配置文件

   - 在项目根目录下创建一个名为 .stylelintrc 的配置文件，可以使用 JSON、YAML 或 JavaScript 格式
   - stylelint-config-standard 是 stylelint 的推荐配置，配置前需要 npm 下载
     ```javascript
     {
       "extends": "stylelint-config-standard",
       "rules": {
         "indentation": 2,
         "color-hex-case": "lower",
         "selector-max-id": 0
       }
     }
     ```

3. 运行
   ```shell
   stylelint "**/*.css"
   ```

#### 主要作用

- 检查 CSS 语法错误
  - Stylelint 可以识别并报告 CSS 代码中的语法错误，例如缺失的分号、不匹配的括号等。这些错误通常不需要明确指定规则，Stylelint 会自动检查并报告错误
- 检查 CSS 使用错误
  - 例如，禁止使用重复的选择器
    ```javascript
    {
      "rules": {
        "no-duplicate-selectors": true
      }
    }
    ```
  - 例如，禁止使用空的规则集
    ```javascript
    {
      "rules": {
        "block-no-empty": true
      }
    }
    ```
- 检查潜在的兼容性问题
  - 可以使用 stylelint-no-unsupported-browser-features 插件，可以检查 CSS 代码中可能导致兼容性问题的功能
  - 例如，禁止使用已弃用的 CSS 属性
    ```javascript
    {
      "rules": {
        "property-no-vendor-prefix": true
      }
    }
    ```
  - 例如，要检查不支持 IE 11 的 CSS 特性，可以在 .stylelintrc 文件中添加以下配置
    ```javascript
    {
      "plugins": ["stylelint-no-unsupported-browser-features"],
      "rules": {
        "plugin/no-unsupported-browser-features": [
          true,
          {
            "browsers": ["IE 11"]
          }
        ]
      }
    }
    ```
- 检查 CSS 性能问题
  - Stylelint 可以识别可能导致性能问题的 CSS 选择器
  - 例如，限制属性选择器的复杂性
    ```javascript
    {
      "rules": {
        "selector-attribute-operator-blacklist": ["="]
      }
    }
    ```
  - 例如，要检查使用了通配符选择器（ \* ）的规则，可以添加以下规则
    ```javascript
    {
      "rules": {
        "selector-max-universal": 0
      }
    }
    ```
- 强制执行一致的代码风格和命名规则
  - Stylelint 可以确保项目中的 CSS 代码遵循一致的风格和命名规则
  - 例如，确保缩进为 2 个空格
    ```javascript
    {
      "rules": {
        "indentation": 2
      }
    }
    ```
  - 例如，确保十六进制颜色值使用小写字母
    ```javascript
    {
      "rules": {
        "color-hex-case": "lower"
      }
    }
    ```
  - 例如，限制选择器中 ID 的最大数量为 0（即禁止使用 ID 选择器）
    ```javascript
    {
      "rules": {
        "selector-max-id": 0
      }
    }
    ```
  - 例如，确保类名符合特定的命名约定（ 例如，BEM 命名约定 ）
    ```javascript
    {
      "rules": {
        "selector-class-pattern": "^[a-z]+[a-z0-9]*(__[a-z0-9]+)*(--[a-z0-9]+)*$"
      }
    }
    ```
- 支持自动修复许多常见的风格问题
  - 命令行执行
    ```javascript
    stylelint "**/*.css" --fix
    ```

#### 检查和管理 CSS 属性的顺序

- 该插件提供了一系列规则，用于定义和强制执行 CSS 属性的排序规则。可以检查属性的顺序；强制执行一致的属性顺序
  ```
  {
      "plugins": [
        "stylelint-order"
      ],
      "rules": {
        "order/order": [
            // 指定属性的预期顺序
        ],
        "order/properties-order": [
            // 指定属性排序的规则
        ]
      }
  }
  ```

#### 使用 Stylelint 检查 html 或 vue 文件

- 指定插件作为处理器，它可以在 Stylelint 检查代码之前对代码进行预处理，Stylelint 会在检查文件时提取其中的 \<style\> 标签内容
  ```
  {
    "processors": ["stylelint-processor-html"],
  }
  ```

#### 使用 Stylelint 检查 less 或 sass（ 和 scss ） 代码

- 因为 Stylelint 已经支持处理 Less 代码
- Sass 需要下载 stylelint-scss 和 stylelint-config-sass-guidelines 插件
  ```
  {
    "plugins": ["stylelint-scss"],
  }
  ```
- 预定义的 less 和 sass 配置

  - 当需要在样式文件中使用 less 的语法时，下载 stylelint-config-recommended-less 包
    ```
    {
      extends: "stylelint-config-recommended-less"
    }
    ```
  - 当需要在样式文件中使用 scss 或者 sass 的语法时，下载 stylelint-config-recommended-scss 包
    ```
    {
      extends: "stylelint-config-recommended-scss"
    }
    ```

#### 防止和 Prettier 冲突

- 如果 Stylelint 和 Prettier 的规则发生冲突，Prettier 的规则将覆盖 Stylelint 的规则，下载 stylelint-config-prettier 包

  ```
  {
    extends: "stylelint-config-prettier"
  }
  ```

## 3. 真实项目使用

- 一般不需要和 webpack 和 vite 集成，单独使用即可
- 假如在 vue + vite + typescript + less（ 或 sass ）的项目中使用 eslint + prettier + stylelint
- eslint，prettier，stylelint 分别对应 .eslintignore，.prettierignore，.stylelintignore 三个文件来配置需要忽略的文件

1. eslint
   ```javascript
   module.exports = {
   	root: true,
   	env: {
   		browser: true,
   		es2021: true,
   		node: true,
   	},
   	extends: [
   		'eslint:recommended',
   		'plugin:vue/vue3-essential',
   		'plugin:@typescript-eslint/recommended',
   		'airbnb',
   		'plugin:prettier/recommended',
   	],
   	overrides: [],
   	parser: 'vue-eslint-parser',
   	parserOptions: {
   		ecmaVersion: 'latest',
   		sourceType: 'module',
   		parser: '@typescript-eslint/parser',
   		jsx: true,
   	},
   	plugins: ['vue', '@typescript-eslint', 'prettier'],
   	rules: {
   		'no-console': ['off'],
   		'prettier/prettier': 'error',
   		indent: ['error', 4],
   		'linebreak-style': ['error', 'unix'],
   		quotes: ['error', 'double'],
   		semi: ['error', 'always'],
   	},
   }
   ```
2. prettier
   ```javascript
   module.exports = {
   	tabWidth: 2,
   	useTabs: false,
   	semi: true,
   	trailingComma: 'none',
   	singleQuote: true,
   	printWidth: 120,
   }
   ```
3. stylelint
   ```javascript
   module.exports = {
   	extends: [
   		'stylelint-config-standard',
   		'stylelint-config-prettier',
   		'stylelint-config-recommended-less',
   		'stylelint-config-standard-vue',
   	],
   	plugins: ['stylelint-order'],
   	// 不同格式的文件指定自定义语法
   	overrides: [
   		{
   			files: ['**/*.(less|css|vue|html)'],
   			customSyntax: 'postcss-less',
   		},
   		{
   			files: ['**/*.(html|vue)'],
   			customSyntax: 'postcss-html',
   		},
   	],
   	ignoreFiles: ['**/*.js', '**/*.jsx', '**/*.tsx', '**/*.ts', '**/*.json', '**/*.md', '**/*.yaml'],
   	rules: {
   		'no-descending-specificity': null, // 禁止在具有较高优先级的选择器后出现被其覆盖的较低优先级的选择器
   		'selector-pseudo-element-no-unknown': [
   			true,
   			{
   				ignorePseudoElements: ['v-deep'],
   			},
   		],
   		'selector-pseudo-class-no-unknown': [
   			true,
   			{
   				ignorePseudoClasses: ['deep'],
   			},
   		],
   		// 指定样式的排序
   		'order/properties-order': [
   			'position',
   			'top',
   			'right',
   			'bottom',
   			'left',
   			'z-index',
   			'display',
   			'justify-content',
   			'align-items',
   			'float',
   			'clear',
   			'overflow',
   			'overflow-x',
   			'overflow-y',
   			'padding',
   			'padding-top',
   			'padding-right',
   			'padding-bottom',
   			'padding-left',
   			'margin',
   			'margin-top',
   			'margin-right',
   			'margin-bottom',
   			'margin-left',
   			'width',
   			'min-width',
   			'max-width',
   			'height',
   			'min-height',
   			'max-height',
   			'font-size',
   			'font-family',
   			'text-align',
   			'text-justify',
   			'text-indent',
   			'text-overflow',
   			'text-decoration',
   			'white-space',
   			'color',
   			'background',
   			'background-position',
   			'background-repeat',
   			'background-size',
   			'background-color',
   			'background-clip',
   			'border',
   			'border-style',
   			'border-width',
   			'border-color',
   			'border-top-style',
   			'border-top-width',
   			'border-top-color',
   			'border-right-style',
   			'border-right-width',
   			'border-right-color',
   			'border-bottom-style',
   			'border-bottom-width',
   			'border-bottom-color',
   			'border-left-style',
   			'border-left-width',
   			'border-left-color',
   			'border-radius',
   			'opacity',
   			'filter',
   			'list-style',
   			'outline',
   			'visibility',
   			'box-shadow',
   			'text-shadow',
   			'resize',
   			'transition',
   		],
   	},
   }
   ```
